import React from 'react'\n\ntype AffiliateButtonProps = {\n  href: string\n  animeId?: number | string\n  provider?: string\n  label?: string\n  className?: string\n  target?: string\n}\n\nexport default function AffiliateButton({ href, animeId, provider = 'affiliate', label = 'Buy / Watch', className = 'affiliate-btn', target = '_blank' }: AffiliateButtonProps) {\n  const handleClick = (e: React.MouseEvent) => {\n    try {\n      const payload = { animeId: animeId ?? null, provider, url: href, timestamp: new Date().toISOString() }\n      const body = JSON.stringify(payload)\n      if (typeof navigator !== 'undefined' && (navigator as any).sendBeacon) {\n        const blob = new Blob([body], { type: 'application/json' })\n        ;(navigator as any).sendBeacon('/api/trackAffiliate', blob)\n      } else {\n        fetch('/api/trackAffiliate', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body, keepalive: true as any }).catch(() => {})\n      }\n    } catch (err) {\n      console.debug('affiliate track failed', err)\n    }\n  }\n\n  const addUtm = (url: string) => {\n    try {\n      const u = new URL(url)\n      if (!u.searchParams.has('utm_source')) u.searchParams.set('utm_source', process.env.NEXT_PUBLIC_AFFILIATE_UTM_SOURCE || 'site')\n      if (!u.searchParams.has('utm_medium')) u.searchParams.set('utm_medium', 'affiliate')\n      if (!u.searchParams.has('utm_campaign')) u.searchParams.set('utm_campaign', provider)\n      return u.toString()\n    } catch {\n      return url\n    }\n  }\n\n  return (\n    <a href={addUtm(href)} onClick={handleClick} className={className} target={target} rel="noopener noreferrer">\n      {label}\n    </a>\n  )\n}